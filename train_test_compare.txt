Comparing training and testing performance using params.json
Loaded 102236 rows of data from data.csv
Data before preprocessing: 102236 rows
NaN values in Open: 0 (0.00%)
NaN values in High: 0 (0.00%)
NaN values in Low: 0 (0.00%)
NaN values in Close: 0 (0.00%)
NaN values in Volume: 0 (0.00%)
NaN values in trade_count: 97957 (95.81%)
NaN values in vwap: 97957 (95.81%)
NaN values in LogReturn: 1 (0.00%)
Rows removed due to NaNs in essential columns: 1 (0.00%)
Data after preprocessing: 102235 rows
Before split: data has 102235 rows
Data split: 61341 rows for training, 40894 rows for testing
Loaded rule parameters from params.json
DEBUG - Returns statistics: count=61340, mean=0.000002, sum=0.126245
DEBUG - Calculated metrics: TR=0.134560, AR=0.000519, Sharpe=0.0747, MaxDD=-0.096013
DEBUG - Returns statistics: count=40893, mean=-0.000001, sum=-0.048618
DEBUG - Calculated metrics: TR=-0.047455, AR=-0.000300, Sharpe=-0.0409, MaxDD=-0.107863

Buy and Hold Performance:
--------------------------------------------------
Training: Total Return: 13.46%, Sharpe: 0.0747
Testing: Total Return: -4.75%, Sharpe: -0.0409

Evaluating Rule1...
DEBUG - Returns statistics: count=61339, mean=0.000003, sum=0.159841
DEBUG - Calculated metrics: TR=0.173324, AR=0.000657, Sharpe=0.0946, MaxDD=-0.057714
DEBUG - Returns statistics: count=40892, mean=-0.000002, sum=-0.089415
DEBUG - Calculated metrics: TR=-0.085534, AR=-0.000551, Sharpe=-0.0753, MaxDD=-0.098134
  Training: Total Return: 17.33%, Sharpe: 0.0946
  Testing: Total Return: -8.55%, Sharpe: -0.0753

Evaluating Rule2...
DEBUG - Returns statistics: count=61339, mean=0.000003, sum=0.164901
DEBUG - Calculated metrics: TR=0.179276, AR=0.000678, Sharpe=0.0976, MaxDD=-0.064619
DEBUG - Returns statistics: count=40892, mean=0.000002, sum=0.067860
DEBUG - Calculated metrics: TR=0.070216, AR=0.000418, Sharpe=0.0571, MaxDD=-0.092302
  Training: Total Return: 17.93%, Sharpe: 0.0976
  Testing: Total Return: 7.02%, Sharpe: 0.0571

Evaluating Rule3...
DEBUG - Returns statistics: count=61339, mean=0.000002, sum=0.142411
DEBUG - Calculated metrics: TR=0.153050, AR=0.000585, Sharpe=0.0843, MaxDD=-0.066081
DEBUG - Returns statistics: count=40892, mean=-0.000003, sum=-0.111918
DEBUG - Calculated metrics: TR=-0.105883, AR=-0.000689, Sharpe=-0.0942, MaxDD=-0.179945
  Training: Total Return: 15.31%, Sharpe: 0.0843
  Testing: Total Return: -10.59%, Sharpe: -0.0942

Evaluating Rule4...
DEBUG - Returns statistics: count=61339, mean=-0.000002, sum=-0.125957
DEBUG - Calculated metrics: TR=-0.118347, AR=-0.000517, Sharpe=-0.0745, MaxDD=-0.165349
DEBUG - Returns statistics: count=40892, mean=0.000001, sum=0.049084
DEBUG - Calculated metrics: TR=0.050308, AR=0.000303, Sharpe=0.0413, MaxDD=-0.061408
  Training: Total Return: -11.83%, Sharpe: -0.0745
  Testing: Total Return: 5.03%, Sharpe: 0.0413

Evaluating Rule5...
DEBUG - Returns statistics: count=61339, mean=0.000002, sum=0.145565
DEBUG - Calculated metrics: TR=0.156693, AR=0.000598, Sharpe=0.0862, MaxDD=-0.085650
DEBUG - Returns statistics: count=40892, mean=-0.000003, sum=-0.137659
DEBUG - Calculated metrics: TR=-0.128604, AR=-0.000848, Sharpe=-0.1159, MaxDD=-0.178754
  Training: Total Return: 15.67%, Sharpe: 0.0862
  Testing: Total Return: -12.86%, Sharpe: -0.1159

Evaluating Rule6...
DEBUG - Returns statistics: count=61339, mean=0.000001, sum=0.047187
DEBUG - Calculated metrics: TR=0.048318, AR=0.000194, Sharpe=0.0279, MaxDD=-0.082808
DEBUG - Returns statistics: count=40892, mean=-0.000002, sum=-0.073907
DEBUG - Calculated metrics: TR=-0.071242, AR=-0.000455, Sharpe=-0.0622, MaxDD=-0.116714
  Training: Total Return: 4.83%, Sharpe: 0.0279
  Testing: Total Return: -7.12%, Sharpe: -0.0622

Evaluating Rule7...
DEBUG - Returns statistics: count=61339, mean=0.000000, sum=0.023068
DEBUG - Calculated metrics: TR=0.023336, AR=0.000095, Sharpe=0.0136, MaxDD=-0.098041
DEBUG - Returns statistics: count=40892, mean=-0.000002, sum=-0.067442
DEBUG - Calculated metrics: TR=-0.065218, AR=-0.000416, Sharpe=-0.0568, MaxDD=-0.114622
  Training: Total Return: 2.33%, Sharpe: 0.0136
  Testing: Total Return: -6.52%, Sharpe: -0.0568

Evaluating Rule8...
DEBUG - Returns statistics: count=61339, mean=0.000002, sum=0.106974
DEBUG - Calculated metrics: TR=0.112905, AR=0.000440, Sharpe=0.0633, MaxDD=-0.083268
DEBUG - Returns statistics: count=40892, mean=0.000000, sum=0.004548
DEBUG - Calculated metrics: TR=0.004558, AR=0.000028, Sharpe=0.0038, MaxDD=-0.078406
  Training: Total Return: 11.29%, Sharpe: 0.0633
  Testing: Total Return: 0.46%, Sharpe: 0.0038

Evaluating Rule9...
DEBUG - Returns statistics: count=61339, mean=0.000001, sum=0.070561
DEBUG - Calculated metrics: TR=0.073110, AR=0.000290, Sharpe=0.0438, MaxDD=-0.068245
DEBUG - Returns statistics: count=40892, mean=-0.000001, sum=-0.054126
DEBUG - Calculated metrics: TR=-0.052687, AR=-0.000333, Sharpe=-0.0491, MaxDD=-0.085614
  Training: Total Return: 7.31%, Sharpe: 0.0438
  Testing: Total Return: -5.27%, Sharpe: -0.0491

Evaluating Rule10...
DEBUG - Returns statistics: count=61339, mean=0.000003, sum=0.162766
DEBUG - Calculated metrics: TR=0.176761, AR=0.000669, Sharpe=0.0963, MaxDD=-0.068260
DEBUG - Returns statistics: count=40892, mean=-0.000004, sum=-0.180648
DEBUG - Calculated metrics: TR=-0.165271, AR=-0.001113, Sharpe=-0.1520, MaxDD=-0.215806
  Training: Total Return: 17.68%, Sharpe: 0.0963
  Testing: Total Return: -16.53%, Sharpe: -0.1520

Evaluating Rule11...
DEBUG - Returns statistics: count=61339, mean=-0.000002, sum=-0.094373
DEBUG - Calculated metrics: TR=-0.090056, AR=-0.000388, Sharpe=-0.0558, MaxDD=-0.169548
DEBUG - Returns statistics: count=40892, mean=0.000004, sum=0.160132
DEBUG - Calculated metrics: TR=0.173666, AR=0.000987, Sharpe=0.1349, MaxDD=-0.050586
  Training: Total Return: -9.01%, Sharpe: -0.0558
  Testing: Total Return: 17.37%, Sharpe: 0.1349

Evaluating Rule12...
DEBUG - Returns statistics: count=61339, mean=0.000003, sum=0.167523
DEBUG - Calculated metrics: TR=0.182372, AR=0.000688, Sharpe=0.0995, MaxDD=-0.068069
DEBUG - Returns statistics: count=40892, mean=-0.000005, sum=-0.189339
DEBUG - Calculated metrics: TR=-0.172494, AR=-0.001166, Sharpe=-0.1600, MaxDD=-0.223553
  Training: Total Return: 18.24%, Sharpe: 0.0995
  Testing: Total Return: -17.25%, Sharpe: -0.1600

Evaluating Rule13...
DEBUG - Returns statistics: count=61339, mean=-0.000002, sum=-0.118809
DEBUG - Calculated metrics: TR=-0.112022, AR=-0.000488, Sharpe=-0.0719, MaxDD=-0.172452
DEBUG - Returns statistics: count=40892, mean=0.000003, sum=0.103722
DEBUG - Calculated metrics: TR=0.109292, AR=0.000639, Sharpe=0.0898, MaxDD=-0.061929
  Training: Total Return: -11.20%, Sharpe: -0.0719
  Testing: Total Return: 10.93%, Sharpe: 0.0898

Evaluating Rule14...
DEBUG - Returns statistics: count=61339, mean=0.000000, sum=0.026921
DEBUG - Calculated metrics: TR=0.027287, AR=0.000111, Sharpe=0.0267, MaxDD=-0.034723
DEBUG - Returns statistics: count=40892, mean=-0.000000, sum=-0.014891
DEBUG - Calculated metrics: TR=-0.014781, AR=-0.000092, Sharpe=-0.0217, MaxDD=-0.055268
  Training: Total Return: 2.73%, Sharpe: 0.0267
  Testing: Total Return: -1.48%, Sharpe: -0.0217

Evaluating Rule15...
WARNING: Empty or all-zero returns array
WARNING: Empty or all-zero returns array
  Training: Total Return: 0.00%, Sharpe: 0.0000
  Testing: Total Return: 0.00%, Sharpe: 0.0000

Evaluating Rule16...
DEBUG - Returns statistics: count=61339, mean=0.000001, sum=0.060580
DEBUG - Calculated metrics: TR=0.062453, AR=0.000249, Sharpe=0.0607, MaxDD=-0.033338
DEBUG - Returns statistics: count=40892, mean=-0.000000, sum=-0.017506
DEBUG - Calculated metrics: TR=-0.017354, AR=-0.000108, Sharpe=-0.0314, MaxDD=-0.041674
  Training: Total Return: 6.25%, Sharpe: 0.0607
  Testing: Total Return: -1.74%, Sharpe: -0.0314

Evaluating Top-3 Rules Strategy (Rules [np.int64(5), np.int64(2), np.int64(11)])...
DEBUG - Generating signals for 16 rules
DEBUG - Rule1 signals: Buy=28739, Sell=32601, Neutral=0
DEBUG - Rule2 signals: Buy=31080, Sell=30260, Neutral=0
DEBUG - Rule3 signals: Buy=29555, Sell=31785, Neutral=0
DEBUG - Rule4 signals: Buy=0, Sell=61340, Neutral=0
DEBUG - Rule5 signals: Buy=30818, Sell=30522, Neutral=0
DEBUG - Rule6 signals: Buy=29666, Sell=31674, Neutral=0
DEBUG - Rule7 signals: Buy=30341, Sell=30999, Neutral=0
DEBUG - Rule8 signals: Buy=29189, Sell=32151, Neutral=0
DEBUG - Rule9 signals: Buy=22928, Sell=30486, Neutral=7926
DEBUG - Rule10 signals: Buy=29468, Sell=31872, Neutral=0
DEBUG - Rule11 signals: Buy=6527, Sell=54813, Neutral=0
DEBUG - Rule12 signals: Buy=29468, Sell=30647, Neutral=1225
DEBUG - Rule13 signals: Buy=4196, Sell=53528, Neutral=3616
DEBUG - Rule14 signals: Buy=8148, Sell=9399, Neutral=43793
DEBUG - Rule15 signals: Buy=0, Sell=0, Neutral=61340
DEBUG - Rule16 signals: Buy=3900, Sell=4154, Neutral=53286
DEBUG - After dropping NaNs, signals_df has 61340 rows
DEBUG - Using top 3 rules: [np.int64(5), np.int64(2), np.int64(11)]
DEBUG - Combined signals: Buy=16282, Sell=45058, Neutral=0
DEBUG - Returns statistics: count=61339, mean=0.000003, sum=0.174694
DEBUG - Calculated metrics: TR=0.190882, AR=0.000718, Sharpe=0.1034, MaxDD=-0.069489
DEBUG - Generating signals for 16 rules
DEBUG - Rule1 signals: Buy=20059, Sell=20834, Neutral=0
DEBUG - Rule2 signals: Buy=20687, Sell=20206, Neutral=0
DEBUG - Rule3 signals: Buy=19798, Sell=21095, Neutral=0
DEBUG - Rule4 signals: Buy=0, Sell=40893, Neutral=0
DEBUG - Rule5 signals: Buy=20624, Sell=20269, Neutral=0
DEBUG - Rule6 signals: Buy=19932, Sell=20961, Neutral=0
DEBUG - Rule7 signals: Buy=20266, Sell=20627, Neutral=0
DEBUG - Rule8 signals: Buy=19945, Sell=20948, Neutral=0
DEBUG - Rule9 signals: Buy=16770, Sell=18773, Neutral=5350
DEBUG - Rule10 signals: Buy=19699, Sell=21194, Neutral=0
DEBUG - Rule11 signals: Buy=4510, Sell=36383, Neutral=0
DEBUG - Rule12 signals: Buy=19699, Sell=20306, Neutral=888
DEBUG - Rule13 signals: Buy=2889, Sell=35470, Neutral=2534
DEBUG - Rule14 signals: Buy=6418, Sell=6893, Neutral=27582
DEBUG - Rule15 signals: Buy=0, Sell=0, Neutral=40893
DEBUG - Rule16 signals: Buy=2871, Sell=2447, Neutral=35575
DEBUG - After dropping NaNs, signals_df has 40893 rows
DEBUG - Using top 3 rules: [np.int64(5), np.int64(2), np.int64(11)]
DEBUG - Combined signals: Buy=10914, Sell=29979, Neutral=0
DEBUG - Returns statistics: count=40892, mean=0.000001, sum=0.034186
DEBUG - Calculated metrics: TR=0.034777, AR=0.000211, Sharpe=0.0288, MaxDD=-0.071801
  Training: Total Return: 19.09%, Sharpe: 0.1034
  Testing: Total Return: 3.48%, Sharpe: 0.0288

Do individual rules outperform the combined strategy?
------------------------------------------------------------
No individual rules outperform the combined strategy on training data.

Rules outperforming combined strategy on TESTING data:
  Rule11: 17.37% (better by 13.89%)
  Rule13: 10.93% (better by 7.45%)
  Rule2: 7.02% (better by 3.54%)
  Rule4: 5.03% (better by 1.55%)

Performance of selected top rules individually:
  Rule2: 7.02% (better by 3.54%)
  Rule5: -12.86% (worse by 16.34%)
  Rule11: 17.37% (better by 13.89%)

Potential implementation issues to check:
------------------------------------------------------------
1. Signal combination method (check rules.py, generate_signals method)
2. Top-N rule selection logic (check if the right rules are being used)
3. Signal application timing (ensure signals are applied with correct delay)
4. NaN handling in signal generation and performance calculation
